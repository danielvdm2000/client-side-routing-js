{"version":3,"sources":["helpers/createDocument.ts","helpers/executeDocumentScripts.ts","helpers/fetchText.ts","helpers/inlineAllDependencies.ts","index.ts"],"names":[],"mappings":"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","file":"bundle.js","sourceRoot":"..\\src","sourcesContent":["function createDocument(documentInnerHTML: string): Document {\r\n  const doc: HTMLDocument = document.implementation.createHTMLDocument();\r\n  doc.documentElement.innerHTML = documentInnerHTML;\r\n  return doc;\r\n}\r\n\r\nexport default createDocument;\r\n","function executeDocumentScripts(doc: Document): void {\r\n  const scripts: Array<HTMLScriptElement> = Array.from(\r\n    doc.querySelectorAll('script:not(.run-once-globally)')\r\n  );\r\n\r\n  scripts.forEach(script => {\r\n    const newScript = doc.createElement('script');\r\n    let code = script.innerHTML;\r\n\r\n    newScript.appendChild(doc.createTextNode(`(function(){${code}})()`));\r\n    script.replaceWith(newScript);\r\n  });\r\n}\r\n\r\nexport default executeDocumentScripts;\r\n","async function fetchText(url: string): Promise<string | null> {\r\n  return fetch(url)\r\n    .then(response => {\r\n      return response.text();\r\n    })\r\n    .catch(error => {\r\n      console.log(error);\r\n      return null;\r\n    });\r\n}\r\n\r\nexport default fetchText;\r\n","import ICachedAssets from '../interfaces/ICachedAssets';\r\nimport fetchText from './fetchText';\r\n\r\nasync function inlineAllDependencies(doc: Document, cachedAssets: ICachedAssets): Promise<string> {\r\n  const stylesheets: Array<HTMLLinkElement> = Array.from(\r\n    doc.querySelectorAll('link[rel=\"stylesheet\"]')\r\n  );\r\n  const scripts: Array<HTMLScriptElement> = Array.from(\r\n    doc.querySelectorAll('script[src]:not(.run-once-globally)')\r\n  );\r\n\r\n  const resolvedAssets = await Promise.all([\r\n    ...getAssets(stylesheets, 'href', cachedAssets),\r\n    ...getAssets(scripts, 'src', cachedAssets),\r\n  ]);\r\n\r\n  const styleCount = stylesheets.length;\r\n  const scriptCount = scripts.length;\r\n\r\n  inlineAsset(stylesheets, 'style', resolvedAssets.slice(0, styleCount));\r\n  inlineAsset(scripts, 'script', resolvedAssets.slice(styleCount, styleCount + scriptCount));\r\n\r\n  return doc.documentElement.innerHTML;\r\n}\r\n\r\nfunction getAssets(\r\n  elements: Array<HTMLElement>,\r\n  srcAttribute: string,\r\n  cachedAssets: ICachedAssets\r\n): Array<Promise<string>> {\r\n  return elements.map(element => {\r\n    const src = element[srcAttribute];\r\n\r\n    if (!(src in cachedAssets)) {\r\n      cachedAssets[src] = fetchText(src);\r\n    }\r\n\r\n    return cachedAssets[src];\r\n  });\r\n}\r\n\r\nfunction inlineAsset(elements: Array<HTMLElement>, newElementType: string, assets: Array<string>) {\r\n  elements.forEach((element: HTMLElement, idx: number) => {\r\n    const newElement: HTMLElement = document.createElement(newElementType);\r\n    newElement.innerHTML = assets[idx];\r\n    element.replaceWith(newElement);\r\n  });\r\n}\r\n\r\nexport default inlineAllDependencies;\r\n","import createDocument from './helpers/createDocument';\r\nimport executeDocumentScripts from './helpers/executeDocumentScripts';\r\nimport fetchText from './helpers/fetchText';\r\nimport inlineAllDependencies from './helpers/inlineAllDependencies';\r\nimport ICachedAssets from './interfaces/ICachedAssets';\r\n\r\nconst cachedAssets: ICachedAssets = {};\r\n\r\nmain();\r\nfunction main(): void {\r\n  const preLoadLinks = true;\r\n  const links: Array<HTMLAnchorElement> = Array.from(\r\n    document.querySelectorAll(\"a:not([target='_blank'])\")\r\n  );\r\n\r\n  // Add current page to cache\r\n  if (!(cleanPageHref(location.href) in cachedAssets)) {\r\n    cachedAssets[cleanPageHref(location.href)] = inlineAllDependencies(\r\n      createDocument(document.documentElement.innerHTML),\r\n      cachedAssets\r\n    );\r\n  }\r\n\r\n  // Override the anchor click events\r\n  links.forEach(link => {\r\n    link.addEventListener('click', customAnchorClickEvent);\r\n  });\r\n\r\n  // Preload pages\r\n  if (preLoadLinks) {\r\n    setTimeout(() => loadAndCachePages(links), 10);\r\n  }\r\n}\r\n\r\n// Navigate to past page on back button\r\nwindow.addEventListener('popstate', () => {\r\n  navigateTo(location.href);\r\n});\r\n\r\n// * the \"this\" parameter is just a way of defining the type of this.\r\nfunction customAnchorClickEvent(this: HTMLAnchorElement, event: MouseEvent): void {\r\n  if (!event.ctrlKey && validLinkToFetch(this)) {\r\n    if (cleanPageHref(this.href) === cleanPageHref(location.href) && this.href.includes('#')) {\r\n      // Navigate to a fragment identifier on the same page (default browser behavior)\r\n    } else if (cleanPageHref(this.href) !== cleanPageHref(location.href)) {\r\n      // Navigate to a new page\r\n      event.preventDefault();\r\n      navigateTo(this.href);\r\n    } else {\r\n      // Navigate to the same page\r\n      event.preventDefault();\r\n      history.pushState('', '', this.href);\r\n    }\r\n  }\r\n}\r\n\r\nfunction loadAndCachePages(links: Array<HTMLAnchorElement>): void {\r\n  links.forEach(async link => {\r\n    if (!(cleanPageHref(link.href) in cachedAssets) && validLinkToFetch(link)) {\r\n      const data = await fetchText(link.href);\r\n\r\n      if (data !== null) {\r\n        cachedAssets[cleanPageHref(link.href)] = inlineAllDependencies(\r\n          createDocument(data),\r\n          cachedAssets\r\n        );\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nfunction validLinkToFetch(link: HTMLAnchorElement): boolean {\r\n  return 'href' in link && link.host === location.host;\r\n}\r\n\r\n// Remove fragment identifier\r\nfunction cleanPageHref(href: string) {\r\n  return href.split('#')[0];\r\n}\r\n\r\nasync function navigateTo(href: string): Promise<void> {\r\n  if (cleanPageHref(href) in cachedAssets) {\r\n    // Navigate to a cached page\r\n    const page = await Promise.resolve(cachedAssets[cleanPageHref(href)]);\r\n    replacePage(href, page);\r\n  } else {\r\n    // Fetch page and navigate to it\r\n    const page = await fetchText(href);\r\n\r\n    if (page === null) {\r\n      window.location.href = href;\r\n    } else {\r\n      replacePage(href, page);\r\n      cachedAssets[cleanPageHref(href)] = inlineAllDependencies(createDocument(page), cachedAssets);\r\n    }\r\n  }\r\n}\r\n\r\nfunction replacePage(href: string, page: string): void {\r\n  document.documentElement.innerHTML = page;\r\n  executeDocumentScripts(document);\r\n  history.pushState('', '', href);\r\n  main();\r\n}\r\n\r\nconsole.log('Client side routing script ran');\r\n"]}