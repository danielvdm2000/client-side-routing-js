{"version":3,"sources":["helpers/createDocument.ts","helpers/executeDocumentScripts.ts","helpers/fetchText.ts","helpers/inlineAllDependencies.ts","index.ts"],"names":[],"mappings":"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","file":"bundle.js","sourceRoot":"..\\src","sourcesContent":["function createDocument(documentInnerHTML: string): Document {\r\n  const doc: HTMLDocument = document.implementation.createHTMLDocument();\r\n  doc.documentElement.innerHTML = documentInnerHTML;\r\n  return doc;\r\n}\r\n\r\nexport default createDocument;\r\n","function executeDocumentScripts(doc: Document): void {\r\n  const scripts: Array<HTMLScriptElement> = Array.from(\r\n    doc.querySelectorAll('script:not(.run-once-globally)')\r\n  );\r\n\r\n  scripts.forEach(script => {\r\n    const newScript = doc.createElement('script');\r\n    let code = script.innerHTML;\r\n\r\n    newScript.appendChild(doc.createTextNode(`(function(){${code}})()`));\r\n    script.replaceWith(newScript);\r\n  });\r\n}\r\n\r\nexport default executeDocumentScripts;\r\n","async function fetchText(url: string): Promise<string | null> {\r\n  return fetch(url)\r\n    .then(response => {\r\n      return response.text();\r\n    })\r\n    .catch(error => {\r\n      console.log(error);\r\n      return null;\r\n    });\r\n}\r\n\r\nexport default fetchText;\r\n","import ICachedAssets from '../interfaces/ICachedAssets';\r\nimport fetchText from './fetchText';\r\n\r\nasync function inlineAllDependencies(doc: Document, cachedAssets: ICachedAssets): Promise<string> {\r\n  const stylesheets: Array<HTMLLinkElement> = Array.from(\r\n    doc.querySelectorAll('link[rel=\"stylesheet\"]')\r\n  );\r\n  const scripts: Array<HTMLScriptElement> = Array.from(\r\n    doc.querySelectorAll('script[src]:not(.run-once-globally)')\r\n  );\r\n\r\n  const resolvedAssets = await Promise.all([\r\n    ...getAssets(stylesheets, 'href', cachedAssets),\r\n    ...getAssets(scripts, 'src', cachedAssets),\r\n  ]);\r\n\r\n  const styleCount = stylesheets.length;\r\n  const scriptCount = scripts.length;\r\n\r\n  inlineAsset(stylesheets, 'style', resolvedAssets.slice(0, styleCount));\r\n  inlineAsset(scripts, 'script', resolvedAssets.slice(styleCount, styleCount + scriptCount));\r\n\r\n  return doc.documentElement.innerHTML;\r\n}\r\n\r\nfunction getAssets(\r\n  elements: Array<HTMLElement>,\r\n  srcAttribute: string,\r\n  cachedAssets: ICachedAssets\r\n): Array<Promise<string>> {\r\n  return elements.map(element => {\r\n    const src = element[srcAttribute];\r\n\r\n    if (!(src in cachedAssets)) {\r\n      cachedAssets[src] = fetchText(src);\r\n    }\r\n\r\n    return cachedAssets[src];\r\n  });\r\n}\r\n\r\nfunction inlineAsset(elements: Array<HTMLElement>, newElementType: string, assets: Array<string>) {\r\n  elements.forEach((element: HTMLElement, idx: number) => {\r\n    const newElement: HTMLElement = document.createElement(newElementType);\r\n    newElement.innerHTML = assets[idx];\r\n    element.replaceWith(newElement);\r\n  });\r\n}\r\n\r\nexport default inlineAllDependencies;\r\n","import createDocument from './helpers/createDocument';\r\nimport executeDocumentScripts from './helpers/executeDocumentScripts';\r\nimport fetchText from './helpers/fetchText';\r\nimport inlineAllDependencies from './helpers/inlineAllDependencies';\r\nimport ICachedAssets from './interfaces/ICachedAssets';\r\n\r\nconst cachedAssets: ICachedAssets = {};\r\n\r\nmain();\r\nfunction main(): void {\r\n  const preLoadLinks = true;\r\n  const links: Array<HTMLAnchorElement> = Array.from(\r\n    document.querySelectorAll(\"a:not([target='_blank'])\")\r\n  );\r\n\r\n  // Add current page to cache\r\n  if (!(location.href in cachedAssets)) {\r\n    cachedAssets[location.href] = inlineAllDependencies(\r\n      createDocument(document.documentElement.innerHTML),\r\n      cachedAssets\r\n    );\r\n  }\r\n\r\n  // Override the anchor click events\r\n  links.forEach(link => {\r\n    link.addEventListener('click', customAnchorClickEvent);\r\n  });\r\n\r\n  // Preload pages\r\n  if (preLoadLinks) {\r\n    setTimeout(() => loadAndCachePages(links), 10);\r\n  }\r\n}\r\n\r\n// Navigate to past page on back button\r\nwindow.addEventListener('popstate', () => {\r\n  navigateTo(location.href);\r\n});\r\n\r\n// * the \"this\" parameter is just a way of defining the type of this.\r\nfunction customAnchorClickEvent(this: HTMLAnchorElement, event: MouseEvent): void {\r\n  if (event.ctrlKey) return;\r\n  if (!('href' in this)) return;\r\n  if (this.host !== location.host) return;\r\n\r\n  event.preventDefault();\r\n\r\n  if (location.href !== this.href) {\r\n    navigateTo(this.href);\r\n  }\r\n}\r\n\r\nfunction loadAndCachePages(links: Array<HTMLAnchorElement>): void {\r\n  links.forEach(async ({ href }) => {\r\n    if (!(href in cachedAssets)) {\r\n      const data = await fetchText(href);\r\n\r\n      if (data !== null) {\r\n        cachedAssets[href] = inlineAllDependencies(createDocument(data), cachedAssets);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nasync function navigateTo(href: string): Promise<void> {\r\n  if (href in cachedAssets) {\r\n    const page = await Promise.resolve(cachedAssets[href]);\r\n    replacePage(href, page);\r\n  } else {\r\n    const page = await fetchText(href);\r\n\r\n    if (page === null) {\r\n      window.location.href = href;\r\n    } else {\r\n      replacePage(href, page);\r\n      cachedAssets[href] = inlineAllDependencies(createDocument(page), cachedAssets);\r\n    }\r\n  }\r\n}\r\n\r\nfunction replacePage(href: string, page: string): void {\r\n  document.documentElement.innerHTML = page;\r\n  executeDocumentScripts(document);\r\n  history.pushState('', '', href);\r\n  main();\r\n}\r\n\r\nconsole.log('Client side routing script ran');\r\n"]}